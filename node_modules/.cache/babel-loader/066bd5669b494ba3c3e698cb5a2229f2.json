{"ast":null,"code":"import _slicedToArray from \"/home/cadu/Driven/Projetos/Projeto_11_Linkr/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/cadu/Driven/Projetos/Projeto_11_Linkr/src/components/pages/timeline/PublishPost.js\",\n    _s = $RefreshSig$();\n\nimport { useContext, useState } from \"react\";\nimport { createPost, getFollowingUsersPosts, getPosts } from \"../../../service/API\";\nimport styled from \"styled-components\";\nimport Swal from \"sweetalert2\";\nimport UserContext from \"../../../contexts/UserContext\";\nimport { Link } from \"react-router-dom\";\nimport { FiMapPin } from 'react-icons/fi';\nimport { Container, ProfileImg, PublishForm, Title, Input, TextArea, PublishBottom, Localization, Submit } from \"./ContainerPublishPost\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PublishPost(_ref) {\n  _s();\n\n  var setPosts = _ref.setPosts;\n\n  var _useContext = useContext(UserContext),\n      user = _useContext.user;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      text = _useState2[0],\n      setText = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      link = _useState4[0],\n      setLink = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isLocating = _useState8[0],\n      setIsLocating = _useState8[1];\n\n  var _useState9 = useState({}),\n      _useState10 = _slicedToArray(_useState9, 2),\n      location = _useState10[0],\n      setLocation = _useState10[1];\n\n  function getLocalization() {\n    if (!isLocating) {\n      setIsLocating(true);\n      navigator.geolocation.getCurrentPosition(function (position) {\n        setLocation({\n          latitude: position.coords.latitude,\n          longitude: position.coords.longitude\n        });\n      }, function (error) {\n        if (error.code === error.PERMISSION_DENIED) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Ops...',\n            text: 'Não foi possível acessar a localização'\n          });\n          setIsLocating(false);\n        }\n      });\n    } else {\n      setIsLocating(false);\n      setLocation({});\n    }\n  }\n\n  function publish(event) {\n    event.preventDefault();\n    setLoading(true);\n    var body;\n\n    if (isLocating) {\n      body = {\n        text: text,\n        link: link,\n        geolocation: {\n          latitude: location.latitude,\n          longitude: location.longitude\n        }\n      };\n    } else {\n      body = {\n        text: text,\n        link: link\n      };\n    }\n\n    createPost({\n      token: user.token,\n      body: body\n    }).then(function () {\n      getFollowingUsersPosts(user.token).then(function (response) {\n        return setPosts(response.data.posts);\n      }).catch(function () {\n        Swal.fire({\n          icon: \"error\",\n          title: \"Ops...\",\n          text: \"Houve uma falha ao obter os posts, por favor atualize a página\"\n        });\n      });\n      setText('');\n      setLink('');\n      setLoading(false);\n    }).catch(function () {\n      setLoading(false);\n      Swal.fire({\n        icon: 'error',\n        title: 'Oops...',\n        text: 'Houve um erro ao publicar seu link'\n      });\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    onSubmit: publish,\n    children: [/*#__PURE__*/_jsxDEV(Link, {\n      to: '/my-posts',\n      children: /*#__PURE__*/_jsxDEV(ProfileImg, {\n        src: user.user.avatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(PublishForm, {\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        children: \"O que voc\\xEA tem pra favoritar hoje?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"url\",\n        required: true,\n        placeholder: \"http://...\",\n        value: link,\n        onChange: function onChange(event) {\n          return setLink(event.target.value);\n        },\n        disabled: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(TextArea, {\n        placeholder: \"Muito irado esse link falando de #javascript\",\n        value: text,\n        onChange: function onChange(event) {\n          return setText(event.target.value);\n        },\n        disabled: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(PublishBottom, {\n        children: [/*#__PURE__*/_jsxDEV(Localization, {\n          isLocating: isLocating,\n          onClick: getLocalization,\n          children: [/*#__PURE__*/_jsxDEV(FiMapPin, {\n            style: {\n              fontSize: '18px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Localiza\\xE7\\xE3o \", isLocating ? 'ativada' : 'desativada']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 21\n        }, this), loading ? /*#__PURE__*/_jsxDEV(Submit, {\n          disabled: loading,\n          children: \"Publicando...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 32\n        }, this) : /*#__PURE__*/_jsxDEV(Submit, {\n          disabled: loading,\n          children: \"Publicar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 84\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 9\n  }, this);\n}\n\n_s(PublishPost, \"iLzWZYRms29of1WWFBgbTq2/ULo=\");\n\n_c = PublishPost;\n\nvar _c;\n\n$RefreshReg$(_c, \"PublishPost\");","map":{"version":3,"sources":["/home/cadu/Driven/Projetos/Projeto_11_Linkr/src/components/pages/timeline/PublishPost.js"],"names":["useContext","useState","createPost","getFollowingUsersPosts","getPosts","styled","Swal","UserContext","Link","FiMapPin","Container","ProfileImg","PublishForm","Title","Input","TextArea","PublishBottom","Localization","Submit","PublishPost","setPosts","user","text","setText","link","setLink","loading","setLoading","isLocating","setIsLocating","location","setLocation","getLocalization","navigator","geolocation","getCurrentPosition","position","latitude","coords","longitude","error","code","PERMISSION_DENIED","fire","icon","title","publish","event","preventDefault","body","token","then","response","data","posts","catch","avatar","target","value","fontSize"],"mappings":"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","sourcesContent":["import { useContext, useState } from \"react\";\nimport { createPost, getFollowingUsersPosts, getPosts } from \"../../../service/API\";\nimport styled from \"styled-components\";\nimport Swal from \"sweetalert2\";\nimport UserContext from \"../../../contexts/UserContext\";\nimport { Link } from \"react-router-dom\";\nimport {FiMapPin} from 'react-icons/fi'\nimport { Container,\n    ProfileImg,\n    PublishForm,\n    Title,\n    Input,\n    TextArea,\n    PublishBottom,\n    Localization,\n    Submit } from \"./ContainerPublishPost\"\nexport default function PublishPost({ setPosts }) {\n\n    const { user } = useContext(UserContext);\n\n    const [text, setText] = useState('');\n    const [link, setLink] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [isLocating, setIsLocating] = useState(false);\n    const [location, setLocation] = useState({});\n    function getLocalization() {\n        if(!isLocating) {\n            setIsLocating(true)\n            navigator.geolocation.getCurrentPosition((position) => {\n                setLocation({latitude: position.coords.latitude, longitude: position.coords.longitude})\n            }, (error) => {\n                if(error.code === error.PERMISSION_DENIED) {\n                    Swal.fire({\n                        icon: 'error',\n                        title: 'Ops...',\n                        text: 'Não foi possível acessar a localização',\n                    })\n                    setIsLocating(false);\n                }\n            }\n            )\n        } else {\n            setIsLocating(false)\n            setLocation({})\n        }\n    }\n\n    function publish(event) {\n        event.preventDefault();\n        setLoading(true);\n        let body;\n        if(isLocating) {\n            body = {\n                text,\n                link,\n                geolocation: {\n                    latitude: location.latitude,\n                    longitude: location.longitude,\n                }\n            }\n        } else {\n            body = {\n               text,\n               link,\n           }\n        }\n\n        createPost({ token: user.token, body })\n            .then(() => {\n                getFollowingUsersPosts(user.token)\n                    .then((response) => setPosts(response.data.posts))\n                    .catch(() => {\n                        Swal.fire({\n                            icon: \"error\",\n                            title: \"Ops...\",\n                            text: \"Houve uma falha ao obter os posts, por favor atualize a página\"\n                        })\n                    })\n                setText('');\n                setLink('');\n                setLoading(false);\n            })\n            .catch(() => {\n                setLoading(false);\n                Swal.fire({\n                    icon: 'error',\n                    title: 'Oops...',\n                    text: 'Houve um erro ao publicar seu link',\n                })\n            })\n    }\n    \n\n    return (\n        <Container onSubmit={publish}>\n            <Link to={'/my-posts'}>\n                <ProfileImg src={user.user.avatar}></ProfileImg>\n            </Link>\n            <PublishForm>\n                <Title>O que você tem pra favoritar hoje?</Title>\n                <Input\n                    type='url'\n                    required\n                    placeholder='http://...'\n                    value={link}\n                    onChange={(event) => setLink(event.target.value)}\n                    disabled={loading}>\n                </Input>\n                <TextArea\n                    placeholder='Muito irado esse link falando de #javascript'\n                    value={text}\n                    onChange={(event) => setText(event.target.value)}\n                    disabled={loading}>\n                </TextArea>\n                <PublishBottom>\n                    <Localization isLocating={isLocating} onClick={getLocalization}>\n                        <FiMapPin style={{fontSize: '18px'}}/>\n                        <span>Localização {isLocating ? 'ativada' : 'desativada'}</span>\n                    </Localization>\n                    {loading ? <Submit disabled={loading}>Publicando...</Submit> : <Submit disabled={loading}>Publicar</Submit>}\n                </PublishBottom>\n            </PublishForm>\n        </Container>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}